<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/layout :: head('Orders Management')}"></head>

<body>
    <nav th:replace="~{fragments/common :: navbar}"></nav>

    <main class="container mt-4">
        <h1>üì¶ Orders Management</h1>

        <!-- Search Form -->
        <form method="get" class="mb-3 mt-4">
            <div class="input-group">
                <input type="text" name="search" class="form-control" placeholder="Search by customer email..." th:value="${search}">
                <button class="btn btn-outline-secondary" type="submit">Search</button>
            </div>
        </form>

        <!-- Stats -->
        <div class="row mb-4 mt-4">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body text-center">
                        <h5>Total Orders</h5>
                        <h2 class="mb-0" th:text="${#lists.size(orders)}"></h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body text-center">
                        <h5>Completed</h5>
                        <h2 class="mb-0" th:text="${#lists.size(orders.?[paymentStatus == 'COMPLETED'])}"></h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Orders Table -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-dark table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Game Keys</th>
                                <th>Total</th>
                                <th>Payment</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="order : ${orders}">
                                <td>#<span th:text="${order.id}"></span></td>
                                <td th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}"></td>
                                <td th:text="${order.user?.username ?: 'N/A'}"></td>
                                <td>
                                    <span class="badge bg-info" th:text="${order.gameKeys != null ? #lists.size(order.gameKeys) : 0}">0</span>
                                    <span> keys</span>
                                </td>
                                <td>$<span th:text="${#numbers.formatDecimal(order.totalPrice, 1, 2)}"></span></td>
                                <td th:text="${order.paymentMethod}"></td>
                                <td>
                                    <span class="badge" th:classappend="${order.paymentStatus == 'COMPLETED' ? 'bg-success' : 'bg-warning'}">
                                        <span th:text="${order.paymentStatus}"></span>
                                    </span>
                                </td>
                                <td>
                                    <a th:href="@{/admin/orders/{id}(id=${order.id})}" class="btn btn-sm btn-primary">
                                        üëÅÔ∏è View
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div th:if="${#lists.isEmpty(orders)}" class="text-center py-5">
                    <p class="text-muted fs-5">No orders yet.</p>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>